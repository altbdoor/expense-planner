angular.module("ExpensePlannerApp",[]).config(["$compileProvider",function(e){e.debugInfoEnabled(!1),e.commentDirectivesEnabled(!1),e.cssClassDirectivesEnabled(!1)}]).factory("ConfigService",[function(){function e(){var e=localStorage.getItem(r);if(e)try{e=JSON.parse(e)}catch(n){}return e}function n(e){e=JSON.stringify(e),localStorage.setItem(r,e)}function a(){localStorage.removeItem(r)}var r="expense-planner-v1";return{load:e,save:n,purge:a}}]).controller("ExpenseController",["ConfigService",function(e){function n(){var n=e.load();n&&angular.forEach(u,function(e){e in n&&e in f&&(f[e]=n[e])}),0==f.expensesList.length&&f.addExpense();var a=document.querySelectorAll(".nav-link");angular.forEach(a,function(e){e.addEventListener("click",function(n){n.preventDefault(),document.querySelector(".nav-link.active").classList.remove("active"),e.classList.add("active");var a=e.getAttribute("href");document.querySelector(".tab-pane.active").classList.remove("active"),document.querySelector(a).classList.add("active")},!1)})}function a(){var n={};angular.forEach(u,function(e){n[e]=f[e]}),e.save(n)}function r(e){e.$valid&&(f.friendsList.push(f.addFriendForm.name),f.addFriendForm.name="",a())}function t(e){var n=f.friendsList[e],r=window.confirm('Delete "'+n+'" from friend list?');r&&(f.friendsList.splice(e,1),a())}function i(){var e=angular.copy(d);f.friendsList.length>0&&(e.payTo=f.friendsList[0]),f.expensesList.push(e)}function o(e){var n=window.confirm("Delete from expenses list?");n&&(f.expensesList.splice(e,1),a())}function s(){a()}function c(){var e={},n="__xx"+Date.now()+"xx__";angular.forEach(f.friendsList,function(a){angular.forEach(f.friendsList,function(r){a!=r&&(e[a+n+r]=0)})}),angular.forEach(f.expensesList,function(a){var r=Number(a.price)+Number(a.adjust),t=[];for(var i in a.from)a.from[i].selected&&-1!==f.friendsList.indexOf(i)&&t.push(i);if(t.length>0){r/=t.length;var o=a.payTo;angular.forEach(t,function(a){a!=o&&(e[a+n+o]+=r)})}});var a=[],r=[];for(var t in e)if(-1===a.indexOf(t)){var i=t.split(n).reverse().join(n),o=t.split(n),s=e[t]-e[i];0!=s&&(0>s&&o.reverse(),r.push({from:o[0],to:o[1],amount:Math.abs(s)})),a.push(t),a.push(i)}f.calculateData=r}function l(n){var a=document.getElementById("raw-data");if("import"==n){var r=a.value;try{r=JSON.parse(a.value),e.save(r),window.location.reload()}catch(t){alert("Invalid JSON format")}}else if("export"==n){var i=e.load();a.value=JSON.stringify(i)}else if("purge"==n){var o=window.confirm("Purge all data?");o&&(e.purge(),window.location.reload())}}var f=this,u=["friendsList","expensesList"];f.friendsList=[],f.addFriend=r,f.removeFriend=t,f.addFriendForm={name:""},f.expensesList=[],f.addExpense=i,f.removeExpense=o,f.saveExpense=s;var d={desc:"",payTo:"",price:0,adjust:0,from:{}};f.calculate=c,f.calculateData=[],f.modifyRawData=l,n()}]);
