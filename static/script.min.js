!function(e,n,t){e.module("ExpensePlannerApp",[]).config(["$compileProvider",function(e){e.debugInfoEnabled(!1),e.commentDirectivesEnabled(!1),e.cssClassDirectivesEnabled(!1)}]).factory("ConfigService",[function(){function e(){var e=localStorage.getItem(a);if(e)try{e=JSON.parse(e)}catch(n){}return e}function n(e){e=JSON.stringify(e),localStorage.setItem(a,e)}function t(){localStorage.removeItem(a)}var a="expense-planner-v1";return{load:e,save:n,purge:t}}]).controller("ExpenseController",["ConfigService",function(a){function r(){var n=a.load();n&&e.forEach(p,function(e){e in n&&e in v&&(v[e]=n[e])}),0==v.expensesList.length&&v.addExpense();var r=t.querySelectorAll(".nav-link");e.forEach(r,function(e){e.addEventListener("click",function(n){n.preventDefault(),t.querySelector(".nav-link.active").classList.remove("active"),e.classList.add("active");var a=e.getAttribute("href");t.querySelector(".tab-pane.active").classList.remove("active"),t.querySelector(a).classList.add("active")},!1)}),v.isReady=!0,t.querySelector(".tab-content").classList.remove("d-none")}function i(){var n={};e.forEach(p,function(e){n[e]=v[e]}),a.save(n)}function s(e){e.$valid&&(v.friendsList.push(v.addFriendForm.name),v.addFriendForm.name="",i())}function o(e){var t=v.friendsList[e],a=n.confirm('Delete "'+t+'" from friend list?');a&&(v.friendsList.splice(e,1),i())}function c(){var n=e.copy(m);v.friendsList.length>0&&(n.payTo=v.friendsList[0]),v.expensesList.push(n)}function l(e){var t=n.confirm("Delete from expenses list?");t&&(v.expensesList.splice(e,1),i())}function f(n){var t=e.element(n.currentTarget);t.text("Data Saved!"),i(),setTimeout(function(){t.text("Save All Data")},1e3)}function d(){var n={},t="__xx"+Date.now()+"xx__";e.forEach(v.friendsList,function(a){e.forEach(v.friendsList,function(e){a!=e&&(n[a+t+e]=0)})}),e.forEach(v.expensesList,function(a){var r=Number(a.price)+Number(a.adjust),i=[];for(var s in a.from)a.from[s].selected&&-1!==v.friendsList.indexOf(s)&&i.push(s);if(i.length>0){r/=i.length;var o=a.payTo;e.forEach(i,function(e){e!=o&&(n[e+t+o]+=r)})}});var a=[],r=[];for(var i in n)if(-1===a.indexOf(i)){var s=i.split(t).reverse().join(t),o=i.split(t),c=n[i]-n[s];0!=c&&(0>c&&o.reverse(),r.push({from:o[0],to:o[1],amount:Math.abs(c)})),a.push(i),a.push(s)}v.calculateData=r}function u(e){var r=t.getElementById("raw-data");if("import"==e){var i=r.value;try{i=JSON.parse(r.value),a.save(i),n.location.reload()}catch(s){alert("Invalid JSON format")}}else if("export"==e){var o=a.load();r.value=JSON.stringify(o)}else if("purge"==e){var c=n.confirm("Purge all data?");c&&(a.purge(),n.location.reload())}}var v=this,p=["friendsList","expensesList"];v.friendsList=[],v.addFriend=s,v.removeFriend=o,v.addFriendForm={name:""},v.expensesList=[],v.addExpense=c,v.removeExpense=l,v.saveExpense=f;var m={desc:"",payTo:"",price:0,adjust:0,from:{}};v.calculate=d,v.calculateData=[],v.modifyRawData=u,v.isReady=!1,r()}])}(angular,window,document);
